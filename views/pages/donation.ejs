<% layout("/layouts/boilerplate.ejs") %>

<title>Donations â€“ Cummins Alumni Portal</title>
<script>
  function openPaymentModal(projectName, amount) {
    document.getElementById('payment-project').innerText = projectName;
    document.getElementById('payment-amount').innerText = amount;
    document.getElementById('paymentModal').classList.remove('hidden');
  }
  function closePaymentModal() {
    document.getElementById('paymentModal').classList.add('hidden');
  }
</script>
</head>
<body id="page-body" class="bg-gray-900 text-gray-100 transition-colors duration-500">

  <!-- Header -->
  <header id="header" class="p-6 bg-gray-800 shadow-lg flex justify-between items-center transition-colors duration-500">
    <h1 class="text-2xl font-bold text-purple-400">Cummins College, Nagpur â€“ Alumni Donations</h1>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="px-3 py-1 rounded-lg border border-gray-600 text-sm">
      ðŸŒ™ Dark
    </button>
  </header>
<!-- Donation Cards (Dynamic from DB) -->
<!-- Donation Cards (Dynamic from DB) -->
<section class="p-6">
  <h2 class="text-xl font-semibold text-purple-300 mb-4">Support Students Requiring Funds/Donations</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <% if (donation.length > 0) { %>
      <% donation.forEach(d => { %>
        <div class="card bg-gray-800 p-4 rounded-xl shadow-lg transition-colors duration-500">
          <img src="<%= d.image || 'https://via.placeholder.com/150' %>"
               alt="Donation" 
               class="h-40 w-full object-cover cursor-pointer"
               onclick="openImageModal('<%= d.image %>')">

          <h3 class="text-lg font-bold text-purple-400"><%= d.studentName %></h3>
          <p class="text-sm text-gray-300"><%= d.description %></p>
          <p class="mt-2 text-sm">Required: <span class="text-green-400 font-bold">â‚¹<%= d.amount %></span></p>
          <p class="mt-2 text-sm">Contact: <span class="text-green-400 font-bold"><%= d.contact %></span></p>

          <form action="/alumni/donation/<%= d._id %>?_method=DELETE" method="POST" 
                onsubmit="return confirm('Delete this request?');" class="mt-3">
            <button class="w-full px-3 py-2 text-sm rounded-lg bg-red-600 hover:bg-red-500">
              Delete
            </button>
          </form>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-gray-400">No donation requests yet.</p>
    <% } %>
  </div>
</section>

<!-- Image Modal -->
<div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
  <span class="absolute top-5 right-8 text-white text-3xl cursor-pointer" onclick="closeImageModal()">&times;</span>
  <img id="modalImage" src="" class="max-h-[90vh] max-w-[90vw] rounded-lg shadow-2xl">
</div>

<script>
  function openImageModal(imgSrc) {
    document.getElementById("modalImage").src = imgSrc;
    document.getElementById("imageModal").classList.remove("hidden");
  }
  function closeImageModal() {
    document.getElementById("imageModal").classList.add("hidden");
  }
</script>


<!-- Add New Donation Card Form -->
<section class="p-6 card bg-gray-800 mt-6 rounded-xl shadow-lg transition-colors duration-500">
  <h2 class="text-xl font-semibold text-purple-300 mb-4">Add New Donation Request</h2>
  <form class="space-y-4" method="POST" action="/alumni/donation" enctype="multipart/form-data">
    <input type="text" name="studentName" placeholder="Student Name" required
           class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">

    <textarea name="description" placeholder="Description (reason, year, course)" required
              class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500"></textarea>

    <input type="number" name="amount" placeholder="Required Amount (â‚¹)" required
           class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">

    <input type="text" name="contact" placeholder="Enter Contact Number" required
           class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">

    <input type="file" name="image" accept="image/*" 
           class="w-full text-gray-300">

    <button type="submit" class="px-6 py-2 bg-purple-600 rounded-lg hover:bg-purple-500">
      Submit
    </button>
  </form>
</section>

<!-- Theme Toggle JS -->
<script>
  const body = document.getElementById("page-body");
  const header = document.getElementById("header");
  const toggleBtn = document.getElementById("theme-toggle");
  const cards = document.querySelectorAll(".card");

  if (localStorage.getItem("theme") === "light") {
    setLightMode();
  } else {
    setDarkMode();
  }

  toggleBtn.addEventListener("click", () => {
    if (body.classList.contains("bg-gray-900")) {
      setLightMode(); localStorage.setItem("theme", "light");
    } else {
      setDarkMode(); localStorage.setItem("theme", "dark");
    }
  });

  function setLightMode() {
    body.classList.remove("bg-gray-900","text-gray-100");
    body.classList.add("bg-white","text-gray-900");
    header.classList.remove("bg-gray-800"); header.classList.add("bg-gray-100");
    cards.forEach(c => { c.classList.remove("bg-gray-800"); c.classList.add("bg-white","border","border-gray-300"); });
    document.querySelectorAll(".text-gray-100,.text-gray-200,.text-gray-300,.text-gray-400").forEach(el => {
      el.classList.remove("text-gray-100","text-gray-200","text-gray-300","text-gray-400");
      el.classList.add("text-gray-800");
    });
    toggleBtn.textContent = "â˜€ï¸ Light";
  }
  function setDarkMode() {
    body.classList.remove("bg-white","text-gray-900");
    body.classList.add("bg-gray-900","text-gray-100");
    header.classList.remove("bg-gray-100"); header.classList.add("bg-gray-800");
    cards.forEach(c => { c.classList.remove("bg-white","border","border-gray-300"); c.classList.add("bg-gray-800"); });
    document.querySelectorAll(".text-gray-800").forEach(el => { el.classList.remove("text-gray-800"); el.classList.add("text-gray-300"); });
    toggleBtn.textContent = "ðŸŒ™ Dark";
  }
</script>
