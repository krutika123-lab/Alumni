<% layout("/layouts/boilerplate.ejs") %>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cummins College,Nagpur-Alumni Portal- Alumni Posts</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body id="page-body" class="bg-gray-900 text-white min-h-screen transition-colors duration-500">

  <!-- Header -->
  <header id="header" class="bg-gray-800 p-4 shadow-md sticky top-0 flex justify-between items-center transition-colors duration-500">
    <h1 class="text-2xl font-bold text-purple-400 text-center">Cummins College,Nagpur-Alumni Portal - Post Yourself</h1>
    <!-- Toggle Button -->
    <button id="theme-toggle" class="px-3 py-1.5 text-sm rounded-lg border border-gray-600 bg-gray-700 text-white">
      🌙 Dark
    </button>
  </header>

  <!-- Form Section -->
  <form action="/alumni/post" method="POST" enctype="multipart/form-data"
        class="max-w-3xl mx-auto mt-6 bg-gray-800 p-6 rounded-xl shadow-lg space-y-4 transition-colors duration-500" id="alumniForm">
    <input type="text" name="name" placeholder="Alumni Name" class="w-full p-2 rounded bg-gray-700 text-white" required>
    <input type="text" name="company" placeholder="Company Name" class="w-full p-2 rounded bg-gray-700 text-white" required>
    <input type="email" name="email" placeholder="Email Address" class="w-full p-2 rounded bg-gray-700 text-white" required>
    <input type="text" name="experience" placeholder="Experience (e.g. 5 years)" class="w-full p-2 rounded bg-gray-700 text-white">
    <input type="text" name="skills" placeholder="Skills (comma separated) and description" class="w-full p-2 rounded bg-gray-700 text-white">
    <input type="file" name="image" accept="image/*" class="w-full text-gray-300">
    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 p-2 rounded-lg">Upload Post</button>
  </form>

  <!-- Search Bar -->
  <section class="p-6 max-w-3xl mx-auto">
    <input type="text" id="searchInput" placeholder="Search Alumni by name, company or skill..."
      class="w-full p-3 rounded-lg bg-gray-800 text-white border border-gray-600 transition-colors duration-500">
  </section>

  <!-- Alumni Cards Section -->
  <section class="p-6">
    <h2 class="text-xl font-semibold text-purple-300 mb-4">Alumni Posts</h2>
    <div id="alumniCards" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <% if (aalumni && aalumni.length > 0) { %>
        <% aalumni.forEach(a => { %>
          <div class="alumni-card bg-gray-800 p-4 rounded-xl shadow-lg transition-colors duration-500"
               data-search="<%= (a.name || '').toLowerCase() %> <%= (a.company || '').toLowerCase() %> <%= (a.skills && a.skills.length ? a.skills.join(' ') : '').toLowerCase() %>">
            <input type="checkbox" class="mb-2" data-email="<%= a.email || '' %>">
            <img src="<%= a.image || 'https://via.placeholder.com/150' %>"
                 alt="Alumni" class="w-24 h-24 rounded-full mx-auto cursor-pointer">
            <h3 class="text-lg font-bold mt-3"><%= a.name || 'Unknown' %></h3>
            <p class="text-gray-300">Company: <%= a.company || 'N/A' %></p>
            <p class="text-gray-300">Email: <%= a.email || 'N/A' %></p>
            <p class="text-gray-300">Experience: <%= a.experience || 'N/A' %></p>
            <p class="text-gray-300">Skills: <%= (a.skills && a.skills.length ? a.skills.join(', ') : 'None') %></p>
            <div class="mt-3 flex gap-2">
              <!-- Edit Button -->
              <a href="/alumni/post/<%= a._id %>/edit"
                 class="px-3 py-1 rounded bg-blue-600 hover:bg-blue-500 text-sm">Edit</a>

              <!-- Delete Button -->
              <form action="/alumni/post/<%= a._id %>?_method=DELETE" method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this post?')">
                <button class="px-3 py-1 rounded bg-red-600 hover:bg-red-500 text-sm">
                  Delete
                </button>
              </form>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <p class="text-gray-400">No alumni posts yet. Be the first to add one!</p>
      <% } %>
    </div>
  </section>

  <!-- 🔍 Image Modal -->
  <div id="imageModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
    <span id="closeModal" class="absolute top-5 right-8 text-white text-3xl cursor-pointer">&times;</span>
    <img id="modalImage" class="max-h-[90%] max-w-[90%] rounded-xl shadow-lg" src="" alt="Enlarged view"/>
  </div>

  <script>
    // Live search
    document.getElementById("searchInput").addEventListener("input", function () {
      const q = this.value.toLowerCase();
      document.querySelectorAll(".alumni-card").forEach(card => {
        card.style.display = card.getAttribute("data-search").includes(q) ? "block" : "none";
      });
    });

    // --- Theme Toggle ---
    const body = document.getElementById("page-body");
    const toggleBtn = document.getElementById("theme-toggle");

    if (localStorage.getItem("theme") === "light") {
      setLightMode();
    } else {
      setDarkMode();
      localStorage.setItem("theme", "dark");
    }

    toggleBtn.addEventListener("click", () => {
      if (body.classList.contains("bg-gray-900")) {
        setLightMode();
        localStorage.setItem("theme", "light");
      } else {
        setDarkMode();
        localStorage.setItem("theme", "dark");
      }
    });

    function setLightMode() {
      body.classList.replace("bg-gray-900","bg-white");
      body.classList.replace("text-white","text-gray-900");

      document.querySelectorAll(".bg-gray-800").forEach(el=>{
        el.classList.replace("bg-gray-800","bg-white");
        el.classList.add("border","border-gray-300");
      });

      document.querySelectorAll(".bg-gray-700").forEach(el=>{
        el.classList.replace("bg-gray-700","bg-gray-100");
        el.classList.replace("text-white","text-gray-900");
      });

      document.querySelectorAll(".text-gray-300, .text-gray-400").forEach(el=>{
        el.classList.remove("text-gray-300","text-gray-400");
        el.classList.add("text-gray-700");
      });

      toggleBtn.textContent="☀️ Light";
    }

    function setDarkMode() {
      body.classList.replace("bg-white","bg-gray-900");
      body.classList.replace("text-gray-900","text-white");

      document.querySelectorAll(".bg-white").forEach(el=>{
        el.classList.replace("bg-white","bg-gray-800");
        el.classList.remove("border","border-gray-300");
      });

      document.querySelectorAll(".bg-gray-100").forEach(el=>{
        el.classList.replace("bg-gray-100","bg-gray-700");
        el.classList.replace("text-gray-900","text-white");
      });

      document.querySelectorAll(".text-gray-700").forEach(el=>{
        el.classList.replace("text-gray-700","text-gray-300");
      });

      toggleBtn.textContent="🌙 Dark";
    }

    // ✅ Image Modal Functionality
    document.querySelectorAll(".alumni-card img").forEach(img => {
      img.addEventListener("click", () => {
        document.getElementById("modalImage").src = img.src;
        document.getElementById("imageModal").classList.remove("hidden");
      });
    });

    document.getElementById("closeModal").addEventListener("click", () => {
      document.getElementById("imageModal").classList.add("hidden");
    });

    document.getElementById("imageModal").addEventListener("click", (e) => {
      if (e.target.id === "imageModal") {
        document.getElementById("imageModal").classList.add("hidden");
      }
    });

    // ESC key closes modal
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        document.getElementById("imageModal").classList.add("hidden");
      }
    });
  </script>
</body>
