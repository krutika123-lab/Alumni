<% layout("/layouts/boilerplate.ejs") %>

  <title>Alumni Posts – Cummins Portal</title>
  
</head>
<body class="bg-gray-900 text-gray-100">

  <!-- Header -->
  <header class="p-4 bg-gray-800 shadow-md flex justify-between items-center">
    <h1 class="text-xl font-bold text-purple-400">Alumni Portal – Send Emails</h1>
    <input type="text" id="searchInput" placeholder="Search alumni..." 
           class="px-3 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500 text-sm w-48 sm:w-64">
  </header>

  <!-- Alumni Form -->
  <section class="p-4">
    <div class="bg-gray-800 p-4 rounded-xl shadow-lg max-w-lg mx-auto">
      <h2 class="text-lg font-semibold text-purple-300 mb-3">Add Alumni Post</h2>
      <form id="alumniForm" class="space-y-3">
        <input type="text" placeholder="Alumni Name" id="name" required
          class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">
        <input type="text" placeholder="Company Name" id="company" required
          class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">
        <input type="email" placeholder="Email Address" id="email" required
          class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">
        <input type="file" id="profileImg" accept="image/*" required
          class="w-full text-gray-300">
        <input type="text" placeholder="Experience (e.g. 5 years in IT)" id="experience"
          class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">
        <input type="text" placeholder="Skills (comma separated)" id="skills"
          class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500">
        <button type="submit" 
          class="w-full px-6 py-2 bg-purple-600 rounded-lg hover:bg-purple-500 font-semibold">Add Alumni Card</button>
      </form>
    </div>
  </section>

  <!-- Alumni Cards -->
  <section class="p-4">
    <h2 class="text-lg font-semibold text-purple-300 mb-3">Alumni Network</h2>
    <div id="alumniCards" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
  </section>

  <!-- Email Section -->
  <section class="p-4 bg-gray-800 mt-6 rounded-xl shadow-lg max-w-lg mx-auto">
    <h2 class="text-lg font-semibold text-purple-300 mb-3">Send Email</h2>
    <textarea id="studentEmails" placeholder="Enter student emails (comma separated)"
      class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-2 focus:ring-purple-500"></textarea>
    <button onclick="sendEmail()" 
      class="mt-3 w-full px-6 py-2 bg-green-600 rounded-lg hover:bg-green-500 font-semibold">Send Email to Selected Alumni</button>
  </section>

  <script>
    const form = document.getElementById("alumniForm");
    const cardsContainer = document.getElementById("alumniCards");
    const searchInput = document.getElementById("searchInput");
    let alumniList = [];

    // Handle Alumni Form Submission
    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const company = document.getElementById("company").value;
      const email = document.getElementById("email").value;
      const experience = document.getElementById("experience").value;
      const skills = document.getElementById("skills").value.split(",");
      const profileImg = document.getElementById("profileImg").files[0];

      if (!profileImg) return alert("Please upload a profile image");

      const reader = new FileReader();
      reader.onload = function(event) {
        const imgURL = event.target.result;
        
        const alumni = { name, company, email, experience, skills, imgURL };
        alumniList.push(alumni);
        renderCards(alumniList);
        form.reset();
      };
      reader.readAsDataURL(profileImg);
    });

    // Render Alumni Cards
    function renderCards(list) {
      cardsContainer.innerHTML = "";
      list.forEach((alumni, index) => {
        const card = document.createElement("div");
        card.className = "bg-gray-800 p-4 rounded-xl shadow-lg";
        card.innerHTML = `
          <input type="checkbox" class="mb-2" data-email="${alumni.email}">
          <img src="${alumni.imgURL}" alt="Profile" class="w-20 h-20 rounded-full mx-auto mb-2 object-cover">
          <h3 class="text-lg font-bold text-purple-400">${alumni.name}</h3>
          <p class="text-sm text-gray-300">${alumni.company}</p>
          <p class="text-sm text-gray-400">${alumni.experience}</p>
          <p class="text-sm text-gray-300">Skills: ${alumni.skills.join(", ")}</p>
          <p class="text-sm text-gray-400">Email: ${alumni.email}</p>
        `;
        cardsContainer.appendChild(card);
      });
    }

    // Smart Search
    searchInput.addEventListener("input", function() {
      const query = this.value.toLowerCase();
      const filtered = alumniList.filter(a =>
        a.name.toLowerCase().includes(query) ||
        a.company.toLowerCase().includes(query) ||
        a.skills.join(" ").toLowerCase().includes(query)
      );
      renderCards(filtered);
    });

    // Send Email Function (mailto draft)
    function sendEmail() {
      const studentEmails = document.getElementById("studentEmails").value.split(",");
      const selectedAlumni = [...document.querySelectorAll("input[type=checkbox]:checked")]
        .map(cb => cb.getAttribute("data-email"));
      
      if (selectedAlumni.length === 0) return alert("No alumni selected!");
      if (studentEmails.length === 0) return alert("Enter student emails!");

      const recipients = [...studentEmails, ...selectedAlumni].join(",");
      window.location.href = `mailto:${recipients}?subject=Alumni Connection&body=Dear Alumni,`;
    }
  </script>

</body>
</html>

